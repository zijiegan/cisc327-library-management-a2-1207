{% extends "base.html" %}

{% block content %}
<h2>üîç Search Books</h2>
<p>Find books in the library catalog.</p>

<form method="GET" action="{{ url_for('search.search_books') }}">
    <div class="form-group">
        <label for="q">Search Term</label>
        <input type="text" id="q" name="q" value="{{ search_term }}" required>
        <small style="color: #666;">Enter title, author, or ISBN to search</small>
    </div>
    
    <div class="form-group">
        <label for="type">Search Type</label>
        <select id="type" name="type">
            <option value="title" {{ 'selected' if search_type == 'title' else '' }}>Title (partial match)</option>
            <option value="author" {{ 'selected' if search_type == 'author' else '' }}>Author (partial match)</option>
            <option value="isbn" {{ 'selected' if search_type == 'isbn' else '' }}>ISBN (exact match)</option>
        </select>
    </div>
    
    <div class="form-group">
        <button type="submit" class="btn">üîç Search</button>
        <a href="{{ url_for('catalog.catalog') }}" class="btn" style="margin-left: 10px;">View All Books</a>
    </div>
</form>

{% if search_term %}
    <hr style="margin: 30px 0;">
    
    <h3>Search Results for "{{ search_term }}" ({{ search_type }})</h3>
    
    {% if books %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>ISBN</th>
                    <th>Availability</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                <tr>
                    <td>{{ book.id }}</td>
                    <td>{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>{{ book.isbn }}</td>
                    <td>
                        {% if book.available_copies > 0 %}
                            <span class="status-available">{{ book.available_copies }}/{{ book.total_copies }} Available</span>
                        {% else %}
                            <span class="status-unavailable">Not Available</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if book.available_copies > 0 %}
                            <form method="POST" action="{{ url_for('borrowing.borrow_book') }}" style="display: inline;">
                                <input type="hidden" name="book_id" value="{{ book.id }}">
                                <input type="text" name="patron_id" placeholder="Patron ID" 
                                       pattern="[0-9]{6}" maxlength="6" required style="width: 100px; margin-right: 5px;">
                                <button type="submit" class="btn btn-success">Borrow</button>
                            </form>
                        {% else %}
                            <span style="color: #666;">Unavailable</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 40px; color: #666;">
            <h4>No results found</h4>
            <p>No books match your search criteria. Try different keywords or search type.</p>
        </div>
    {% endif %}
{% endif %}

<div style="margin-top: 30px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
    <h4>‚ö†Ô∏è Not Yet Implemented</h4>
    <p>The search functionality is currently under development. It should support:</p>
    <ul>
        <li><strong>Title search:</strong> Partial matching, case-insensitive</li>
        <li><strong>Author search:</strong> Partial matching, case-insensitive</li>
        <li><strong>ISBN search:</strong> Exact matching</li>
        <li>Return results in the same format as the main catalog</li>
    </ul>
</div>
{% endblock %}
